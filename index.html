<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âú®Á∫øÂõæÂ∫ì</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <style>

        .album-actions .el-button {
            margin: 0 !important;

        }

        .action-buttons .el-button {
            margin: 0 !important;

        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .album-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .album-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .album-cover {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .album-info {
            padding: 15px;
        }

        .album-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .album-meta {
            font-size: 14px;
            color: #666;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .image-item {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;

            transition: all 0.3s;
        }


        .image-item.selected {
            border: 3px solid #409eff;
            transform: scale(0.95);
        }

        .selection-checkbox {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 24px;
            height: 24px;
            background: #409eff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 5;
        }

        .selection-checkbox span {
            font-size: 16px;
        }


        .selection-checkbox span {
            font-size: 16px;
        }


        @media (max-width: 768px) {
            .selection-checkbox {
                width: 20px;
                height: 20px;
            }

            .selection-checkbox span {
                font-size: 14px;
            }
        }

        .image-thumb {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .back-button {
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .album-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .image-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .image-item:hover .image-actions,
        .image-actions.always-visible {
            opacity: 1;
        }

        .action-button {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .image-detail-layout {
            display: flex;
            height: calc(100vh - 100px);
            gap: 0;
            box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.1);
        }

        .image-section {
            flex: 7;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .nav-button {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #409eff;
            color: #409eff;
            font-size: 18px;
            z-index: 10;
        }

        .nav-button.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #ccc;
            color: #ccc;
        }

        .image-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            max-width: calc(100% - 120px);
            height: 100%;
        }

        .detail-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .info-section {
            flex: 3;
            min-width: 300px;
            background: white;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
        }

        .info-panel {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .info-content {
            flex: 1;
        }

        .info-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
            line-height: 1.5;
            font-size: 14px;
            word-break: break-all; /* Ê∑ªÂä†Ëøô‰∏ÄË°å */
        }

        .action-buttons {
            /*margin: 20px 0;*/
            display: flex;
            flex-direction: column;
            gap: 10px;
        }


        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .header h1 {
                font-size: 1.5rem;
                text-align: center;
            }

            .album-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .album-cover {
                height: 150px;
            }

            .album-info {
                padding: 10px;
            }

            .album-name {
                font-size: 16px;
            }

            .album-meta {
                font-size: 12px;
            }

            .image-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }

            .album-actions {
                flex-direction: column;
            }

            .image-detail-layout {
                flex-direction: column;
                height: auto;
            }

            .image-section {
                flex: none;
                height: 60vh;
                padding: 10px;
            }

            .nav-button {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .image-container {
                max-width: calc(100% - 100px);
            }

            .info-section {
                flex: none;
                min-width: auto;
                border-left: none;
                border-top: 1px solid #e0e0e0;
            }

            .info-panel {
                padding: 15px;
            }

            .el-dialog {
                width: 95% !important;
                max-width: 95% !important;
            }

        }

        @media (max-width: 480px) {
            .album-grid {
                grid-template-columns: 1fr;
            }

            .image-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .thumbnails {
                grid-template-columns: repeat(3, 1fr);
            }
        }


        /*floatingstart*/
        .floating-toolbar {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid #e0e0e0;
            z-index: 100;
        }

        .floating-toolbar .el-button {
            width: 45px;
            height: 45px;
            font-size: 18px;
        }

        .floating-toolbar .el-button .el-icon {
            font-size: 20px;
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .floating-toolbar {
                bottom: 20px;
                padding: 10px 16px;
                gap: 12px;
            }

            .floating-toolbar .el-button {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .floating-toolbar .el-button .el-icon {
                font-size: 18px;
            }
        }

        /*floatingend*/



        /**f2**/

        .floating-toolbar2 {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    background: rgba(255, 255, 255, 0.95);
    padding: 12px 20px;
    border-radius: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid #e0e0e0;
    z-index: 1000;
}

.floating-toolbar2 .el-button {
    width: 45px;
    height: 45px;
    font-size: 18px;
}

.floating-toolbar2 .el-button .el-icon {
    font-size: 20px;
}

.floating-toolbar2 .el-button.is-disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

/* ÁßªÂä®Á´ØÈÄÇÈÖç */
@media (max-width: 768px) {
    .floating-toolbar2 {
        bottom: 20px;
        padding: 10px 16px;
        gap: 12px;
    }

    .floating-toolbar2 .el-button {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }

    .floating-toolbar2 .el-button .el-icon {
        font-size: 18px;
    }
}

        /**f2 end**/


    </style>
</head>
<body>
<div id="app">
    <div class="container">
        <!-- Áõ∏ÂÜåÂàóË°®È°µÈù¢ -->
        <div v-if="currentView === 'albums'">
            <div class="header">
                <h1>ÊàëÁöÑÁõ∏ÂÜå</h1>
                <el-button type="primary" @click="showCreateAlbumDialog = true">Êñ∞Âª∫Áõ∏ÂÜå</el-button>
            </div>

            <div v-if="albums.length === 0" class="empty-state">
                <p>ËøòÊ≤°ÊúâÁõ∏ÂÜåÔºåÂàõÂª∫‰∏Ä‰∏™ÂêßÔºÅ</p>
            </div>

            <div class="album-grid" v-else>
                <div v-for="album in albums" :key="album.id" class="album-card" @click="openAlbum(album.id)">
                    <img v-if="album.cover_filename" :src="`/api/images/${album.cover_image_id}/file?type=thumbnail`"
                         :alt="album.name" class="album-cover">
                    <div v-else class="album-cover"
                         style="display: flex; align-items: center; justify-content: center;">
                        <span>ÊöÇÊó†Â∞ÅÈù¢</span>
                    </div>
                    <div class="album-info">
                        <div class="album-name">{{ album.name }}</div>
                        <div class="album-meta">
                            <div>ÂõæÁâá: {{ getAlbumImageCount(album.id) }}</div>
                            <div>ÂàõÂª∫: {{ formatDate(album.created_at) }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Áõ∏ÂÜåËØ¶ÊÉÖÈ°µÈù¢ -->
        <div v-if="currentView === 'album-detail'">
            <div class="back-button">
                <el-button @click="backToAlbums">ËøîÂõûÁõ∏ÂÜåÂàóË°®</el-button>
            </div>

            <div class="header">
                <h1>{{ currentAlbum.name }}</h1>
                <div class="album-actions">
                    <el-button @click="showEditAlbumDialog = true">ÁºñËæëÁõ∏ÂÜå</el-button>
                    <el-button @click="showUploadDialog = true">‰∏ä‰º†ÂõæÁâá</el-button>


<!--                     <el-button-->
<!--        @click="toggleFavoriteFilter"-->
<!--        :type="showFavoritesOnly ? 'warning' : 'default'"-->
<!--    >-->
<!--        {{ showFavoritesOnly ? 'ÊòæÁ§∫ÂÖ®ÈÉ®' : 'Âè™ÁúãÊî∂Ëóè' }}-->
<!--    </el-button>-->

<!--                    <el-button-->
<!--                            @click="toggleSelectionMode"-->
<!--                            :type="selectionMode ? 'primary' : 'default'"-->
<!--                    >-->
<!--                        Â§öÈÄâ-->
<!--                    </el-button>-->

<!--                    <el-button-->
<!--                            @click="selectAllImages"-->
<!--                            v-if="selectionMode"-->
<!--                            :disabled="images.length === 0"-->
<!--                    >-->
<!--                        {{ isAllSelected ? 'ÂèñÊ∂àÂÖ®ÈÄâ' : 'ÂÖ®ÈÄâ' }}-->

<!--                    </el-button>-->
<!--                    <el-button-->
<!--                            type="danger"-->
<!--                            :disabled="selectedImages.length === 0"-->
<!--                            @click="batchDeleteImages"-->
<!--                            v-if="selectionMode"-->
<!--                    >-->
<!--                        ÊâπÈáèÂà†Èô§ ({{ selectedImages.length }})-->
<!--                    </el-button>-->


                    <el-button type="danger" @click="deleteAlbum(currentAlbum.id)">Âà†Èô§Áõ∏ÂÜå</el-button>
                </div>
            </div>

            <div class="album-meta" style="margin-bottom: 20px;">
                <p v-if="currentAlbum.shoot_date"><strong>ÊãçÊëÑÊó•Êúü:</strong> {{ formatDate(currentAlbum.shoot_date) }}
                </p>
                <p v-if="currentAlbum.model_name"><strong>Ê®°Áâπ:</strong> {{ currentAlbum.model_name }}</p>
                <p v-if="currentAlbum.location"><strong>Âú∞ÁÇπ:</strong> {{ currentAlbum.location }}</p>
            </div>

            <div v-if="images.length === 0" class="empty-state">
                <p>Ëøô‰∏™Áõ∏ÂÜåËøòÊ≤°ÊúâÂõæÁâáÔºå‰∏ä‰º†‰∏Ä‰∫õÂêßÔºÅ</p>
            </div>

            <!--            <div class="image-grid" v-else>-->
            <!--                <div v-for="image in images" :key="image.id" class="image-item" @click="viewImage(image.id)">-->
            <!--                    <img :src="`/api/images/${image.id}/file?type=thumbnail`" :alt="image.original_filename"-->
            <!--                         class="image-thumb">-->
            <!--                    <div class="image-actions" :class="{ 'always-visible': image.is_favorited }">-->

            <!--                        <button-->
            <!--                                class="action-button"-->
            <!--                                :class="{ 'favorited': image.is_favorited }"-->
            <!--                                @click.stop="toggleFavorite(image.id)"-->
            <!--                                :title="image.is_favorited ? 'ÂèñÊ∂àÊî∂Ëóè' : 'Êî∂Ëóè'"-->
            <!--                        >-->
            <!--                            {{ image.is_favorited ? '‚≠ê' : '‚òÜ' }}-->
            <!--                        </button>-->
            <!--                        &lt;!&ndash;                        <button class="action-button" @click.stop="setAsCover(image.id)" title="ËÆæ‰∏∫Â∞ÅÈù¢">‚≠ê</button>&ndash;&gt;-->
            <!--                        <button class="action-button" @click.stop="deleteImage(image.id)" title="Âà†Èô§ÂõæÁâá">üóëÔ∏è</button>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--            </div>-->


            <div class="image-grid" v-else><!-- imagesÊîπ‰∏∫filteredImages -->
                <div

                        v-for="image in filteredImages"

                        :key="image.id"
                        class="image-item"
                        :class="{ 'selected': selectionMode && selectedImages.includes(image.id) }"
                        @click="handleImageClick(image.id)"
                >
                    <div class="selection-checkbox" v-if="selectionMode && selectedImages.includes(image.id)">
                        <span>‚úÖ</span>
                    </div>
                    <img
                            :src="`/api/images/${image.id}/file?type=thumbnail`"
                            :alt="image.original_filename"
                            class="image-thumb"
                    />
                    <div class="image-actions" :class="{ 'always-visible': image.is_favorited }">
                        <button
                                class="action-button"
                                :class="{ 'favorited': image.is_favorited }"
                                @click.stop="toggleFavorite(image.id)"
                                :title="image.is_favorited ? 'ÂèñÊ∂àÊî∂Ëóè' : 'Êî∂Ëóè'"
                        >
                            {{ image.is_favorited ? '‚≠ê' : '‚òÜ' }}
                        </button>
                        <button class="action-button" @click.stop="deleteImage(image.id)" title="Âà†Èô§ÂõæÁâá">üóëÔ∏è</button>
                    </div>
                </div>
            </div>










        </div>




               <!-- ÊÇ¨ÊµÆÂ∑•ÂÖ∑Á™ó -->
    <div class="floating-toolbar2" v-if="filteredImages.length > 0">
        <el-button
            circle
            :type="showFavoritesOnly ? 'warning' : 'default'"
            @click="toggleFavoriteFilter"
            :title="showFavoritesOnly ? 'ÊòæÁ§∫ÂÖ®ÈÉ®' : 'Âè™ÁúãÊî∂Ëóè'"
        >
            üåü
        </el-button>
        <el-button
            circle
            :type="selectionMode ? 'primary' : 'default'"
            @click="toggleSelectionMode"
            title="Â§öÈÄâÊ®°Âºè"
        >
            ‚òëÔ∏è
        </el-button>
        <el-button
            circle
            @click="selectAllImages"
            :disabled="!selectionMode || filteredImages.length === 0"
            :title="isAllSelected ? 'ÂèñÊ∂àÂÖ®ÈÄâ' : 'ÂÖ®ÈÄâ'"
        >
            ‚úÖ
        </el-button>
        <el-button
            circle
            type="danger"
            @click="batchDeleteImages"
            :disabled="!selectionMode || selectedImages.length === 0"
            :title="`ÊâπÈáèÂà†Èô§ (${selectedImages.length})`"
        >
            üóëÔ∏è
        </el-button>
    </div>
</div>

        <!--        </div>-->

        <!-- ÂõæÁâáËØ¶ÊÉÖÈ°µÈù¢ -->
        <div v-if="currentView === 'image-detail'">
            <div class="back-button">
                <el-button @click="backToAlbum">ËøîÂõûÁõ∏ÂÜå</el-button>
            </div>

            <div class="image-detail-layout">
                <div class="image-section">
                    <div class="nav-button prev-button" :class="{ disabled: !hasPrev }" @click="prevImage">‚Üê</div>
                    <div class="image-container">
                        <img :src="`/api/images/${currentImage.id}/file?type=compressed`"
                             :alt="currentImage.original_filename" class="detail-image"/>
                    </div>
                    <div class="nav-button next-button" :class="{ disabled: !hasNext }" @click="nextImage">‚Üí</div>


                    <!-- ÊÇ¨ÊµÆÂ∑•ÂÖ∑Á™ó -->
                    <div class="floating-toolbar">
                        <el-button
                                circle
                                :type="currentImage.is_favorited ? 'primary' : 'default'"
                                @click="toggleFavorite(currentImage.id)"
                                :title="currentImage.is_favorited ? 'ÂèñÊ∂àÊî∂Ëóè' : 'Êî∂Ëóè'"
                        >
                            üåü
                        </el-button>
                        <el-button
                                circle
                                type="danger"
                                @click="deleteImage(currentImage.id)"
                                title="Âà†Èô§ÂõæÁâá"
                        >
                            üóëÔ∏è
                        </el-button>
                    </div>


                </div>

                <div class="info-section">
                    <div class="info-panel">
                        <h3>ÂõæÁâá‰ø°ÊÅØ</h3>
                        <div class="info-content" style="margin-top:30px">


                            <!--                            <div class="info-item"><strong>Êñá‰ª∂Âêç:</strong> {{ currentImage.original_filename }}</div>-->

                            <div class="info-item">
                                <strong>Êñá‰ª∂Âêç: </strong><!--ÊòæÁ§∫ËæìÂÖ•Ê°ÜÂêéËá™Âä®Ëé∑ÂæóÁÑ¶ÁÇπ-->
                                <span class="filename-display" v-if="!renamingFile"
                                      @dblclick="startRename">{{ currentImage.original_filename}}
                                    <!--                                    <el-button type="text" size="small"  >Edit</el-button>-->
                                </span>
                                <el-input v-else v-model="newFilename" size="small"
                                          style="width: 200px; margin-left: 8px;" @keyup.enter="confirmRename"
                                          @keyup.esc="cancelRename"
                                          @blur="cancelRename"/>
                            </div>


                            <div class="info-item"><strong>Êñá‰ª∂Â§ßÂ∞è:</strong> {{ formatFileSize(currentImage.file_size)
                                }}
                            </div>
                            <div class="info-item"><strong>Â∞∫ÂØ∏:</strong> {{ currentImage.width }} √ó
                                {{ currentImage.height }}
                            </div>
                            <div class="info-item"><strong>‰∏ä‰º†Êó∂Èó¥:</strong> {{ formatDate(currentImage.uploaded_at) }}
                            </div>
                            <div class="info-item"><strong>ÂΩìÂâç‰ΩçÁΩÆ:</strong> {{ currentImageIndex + 1 }} /
                                {{ images.length }}
                            </div>
                        </div>


                        <div class="action-buttons">
                            <el-button type="primary" @click="downloadImage(currentImage.id)">‰∏ãËΩΩÂéüÂõæ</el-button>
                            <el-button type="primary" @click="setAsCover(currentImage.id)">ËÆæ‰∏∫Â∞ÅÈù¢</el-button>


                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- ÂØπËØùÊ°Ü -->
        <el-dialog v-model="showCreateAlbumDialog" title="Êñ∞Âª∫Áõ∏ÂÜå">
            <el-form :model="newAlbum">
                <el-form-item label="Áõ∏ÂÜåÂêçÁß∞">
                    <el-input v-model="newAlbum.name" placeholder="ËØ∑ËæìÂÖ•Áõ∏ÂÜåÂêçÁß∞"></el-input>
                </el-form-item>
                <el-form-item label="ÊãçÊëÑÊó•Êúü">
                    <el-date-picker v-model="newAlbum.shoot_date" type="date"
                                    placeholder="ÈÄâÊã©ÊãçÊëÑÊó•Êúü"></el-date-picker>
                </el-form-item>
                <el-form-item label="Ê®°Áâπ">
                    <el-input v-model="newAlbum.model_name" placeholder="ËØ∑ËæìÂÖ•Ê®°ÁâπÂêçÂ≠ó"></el-input>
                </el-form-item>
                <el-form-item label="Âú∞ÁÇπ">
                    <el-input v-model="newAlbum.location" placeholder="ËØ∑ËæìÂÖ•ÊãçÊëÑÂú∞ÁÇπ"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="showCreateAlbumDialog = false">ÂèñÊ∂à</el-button>
                <el-button type="primary" @click="createAlbum">ÂàõÂª∫</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="showEditAlbumDialog" title="ÁºñËæëÁõ∏ÂÜå">
            <el-form :model="currentAlbum">
                <el-form-item label="Áõ∏ÂÜåÂêçÁß∞">
                    <el-input v-model="currentAlbum.name" placeholder="ËØ∑ËæìÂÖ•Áõ∏ÂÜåÂêçÁß∞"></el-input>
                </el-form-item>
                <el-form-item label="ÊãçÊëÑÊó•Êúü">
                    <el-date-picker v-model="currentAlbum.shoot_date" type="date"
                                    placeholder="ÈÄâÊã©ÊãçÊëÑÊó•Êúü"></el-date-picker>
                </el-form-item>
                <el-form-item label="Ê®°Áâπ">
                    <el-input v-model="currentAlbum.model_name" placeholder="ËØ∑ËæìÂÖ•Ê®°ÁâπÂêçÂ≠ó"></el-input>
                </el-form-item>
                <el-form-item label="Âú∞ÁÇπ">
                    <el-input v-model="currentAlbum.location" placeholder="ËØ∑ËæìÂÖ•ÊãçÊëÑÂú∞ÁÇπ"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="showEditAlbumDialog = false">ÂèñÊ∂à</el-button>
                <el-button type="primary" @click="updateAlbum">‰øùÂ≠ò</el-button>
            </template>
        </el-dialog>

        <el-dialog v-model="showUploadDialog" title="‰∏ä‰º†ÂõæÁâá">
            <el-upload drag multiple :action="`/api/albums/${currentAlbum.id}/images`" :on-success="handleUploadSuccess"
                       :on-error="handleUploadError" :before-upload="beforeUpload">
                <div class="el-upload__text">Â∞ÜÊñá‰ª∂ÊãñÂà∞Ê≠§Â§ÑÔºåÊàñ<em>ÁÇπÂáª‰∏ä‰º†</em></div>
                <template #tip>
                    <div class="el-upload__tip">Âè™ËÉΩ‰∏ä‰º†jpg/pngÊñá‰ª∂</div>
                </template>
            </el-upload>
            <template #footer>
                <el-button @click="showUploadDialog = false">ÂÖ≥Èó≠</el-button>
            </template>
        </el-dialog>
    </div>
</div>

<script>
    const {createApp, ref, onMounted, computed} = Vue;
    const {ElMessage, ElMessageBox} = ElementPlus;

    createApp({
        setup() {

            const currentView = ref('albums');
            const albums = ref([]);
            const images = ref([]);
            const currentAlbum = ref({});
            const currentImage = ref({});


            const showCreateAlbumDialog = ref(false);
            const showEditAlbumDialog = ref(false);
            const showUploadDialog = ref(false);

            const newAlbum = ref({
                name: '',
                shoot_date: '',
                model_name: '',
                location: '',
            });

            const currentImageIndex = computed(() => {
                return images.value.findIndex(img => img.id === currentImage.value.id);
            });

            const hasPrev = computed(() => currentImageIndex.value > 0);
            const hasNext = computed(() => currentImageIndex.value < images.value.length - 1);

            // const getAlbumImageCount = (albumId) => {
            //     // ÁÆÄÂåñÂÆûÁé∞ÔºåÂÆûÈôÖÂ∫îËØ•‰ªéÂêéÁ´ØËé∑Âèñ
            //     return images.value.filter(img => img.album_id === albumId).length;
            // };

            const getAlbumImageCount = (albumId) => {
                const album = albums.value.find(a => a.id === albumId);
                return album ? album.image_count : 0;
            };

            const loadAlbums = async () => {
                try {
                    const response = await fetch('/api/albums');
                    albums.value = await response.json();
                } catch (error) {
                    ElMessage.error('Âä†ËΩΩÁõ∏ÂÜåÂ§±Ë¥•');
                }
            };

            const loadAlbumImages = async (albumId) => {
                try {
                    const response = await fetch(`/api/albums/${albumId}/images`);
                    images.value = await response.json();
                } catch (error) {
                    ElMessage.error('Âä†ËΩΩÂõæÁâáÂ§±Ë¥•');
                }
            };

            const createAlbum = async () => {
                if (!newAlbum.value.name) {
                    ElMessage.warning('ËØ∑ËæìÂÖ•Áõ∏ÂÜåÂêçÁß∞');
                    return;
                }
                try {
                    const response = await fetch('/api/albums', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(newAlbum.value)
                    });
                    if (response.ok) {
                        ElMessage.success('Áõ∏ÂÜåÂàõÂª∫ÊàêÂäü');
                        showCreateAlbumDialog.value = false;
                        newAlbum.value = {
                            name: '',
                            description: '',
                            shoot_date: '',
                            model_name: '',
                            weather: '',
                            equipment: ''
                        };
                        loadAlbums();
                    }
                } catch (error) {
                    ElMessage.error('ÂàõÂª∫Áõ∏ÂÜåÂ§±Ë¥•');
                }
            };

            const updateAlbum = async () => {
                try {
                    const response = await fetch(`/api/albums/${currentAlbum.value.id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(currentAlbum.value)
                    });
                    if (response.ok) {
                        ElMessage.success('Áõ∏ÂÜåÊõ¥Êñ∞ÊàêÂäü');
                        showEditAlbumDialog.value = false;
                        loadAlbums();
                    }
                } catch (error) {
                    ElMessage.error('Êõ¥Êñ∞Áõ∏ÂÜåÂ§±Ë¥•');
                }
            };

            const deleteAlbum = async (albumId) => {
                try {
                    await ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Áõ∏ÂÜåÂêóÔºüÁõ∏ÂÜå‰∏≠ÁöÑÊâÄÊúâÂõæÁâá‰πüÂ∞ÜË¢´Âà†Èô§„ÄÇ', 'Ë≠¶Âëä', {
                        confirmButtonText: 'Á°ÆÂÆö', cancelButtonText: 'ÂèñÊ∂à', type: 'warning'
                    });
                    const response = await fetch(`/api/albums/${albumId}`, {method: 'DELETE'});
                    if (response.ok) {
                        ElMessage.success('Áõ∏ÂÜåÂà†Èô§ÊàêÂäü');
                        backToAlbums();
                        loadAlbums();
                    }
                } catch (error) {
                    if (error !== 'cancel') ElMessage.error('Âà†Èô§Áõ∏ÂÜåÂ§±Ë¥•');
                }
            };

            const openAlbum = async (albumId) => {
                const album = albums.value.find(a => a.id === albumId);
                if (album) {
                    currentAlbum.value = {...album};
                    await loadAlbumImages(albumId);
                    currentView.value = 'album-detail';
                }
            };

            const backToAlbums = () => {
                currentView.value = 'albums';
                currentAlbum.value = {};
                images.value = [];
                selectionMode.value = false;
                selectedImages.value = [];
            };

            const backToAlbum = () => {
                currentView.value = 'album-detail';
                currentImage.value = {};

                selectionMode.value = false;
                selectedImages.value = [];
            };

            const viewImage = (imageId) => {
                const image = images.value.find(img => img.id === imageId);
                if (image) {
                    currentImage.value = image;
                    currentView.value = 'image-detail';
                }
            };

            const prevImage = () => {
                if (hasPrev.value) {
                    currentImage.value = images.value[currentImageIndex.value - 1];
                } else {
                    ElMessage.info('Â∑≤ÁªèÊòØÁ¨¨‰∏ÄÂº†ÂõæÁâá‰∫Ü');
                }
            };

            const nextImage = () => {
                if (hasNext.value) {
                    currentImage.value = images.value[currentImageIndex.value + 1];
                } else {
                    ElMessage.info('Â∑≤ÁªèÊòØÊúÄÂêé‰∏ÄÂº†ÂõæÁâá‰∫Ü');
                }
            };

            const handleUploadSuccess = () => {
                ElMessage.success('ÂõæÁâá‰∏ä‰º†ÊàêÂäü');
                loadAlbumImages(currentAlbum.value.id);
            };

            const handleUploadError = () => {
                ElMessage.error('ÂõæÁâá‰∏ä‰º†Â§±Ë¥•');
            };

            const beforeUpload = (file) => {
                // const isJPGOrPNG = file.type === 'image/jpeg' || file.type === 'image/png';
                // const isLt10M = file.size / 1024 / 1024 < 10;
                // if (!isJPGOrPNG) ElMessage.error('Âè™ËÉΩ‰∏ä‰º†JPG/PNGÊ†ºÂºèÁöÑÂõæÁâá!');
                // if (!isLt10M) ElMessage.error('ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá10MB!');
                // return isJPGOrPNG && isLt10M;
            };

            const deleteImage = async (imageId) => {
                try {
                    await ElMessageBox.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÂº†ÂõæÁâáÂêóÔºü', 'Ë≠¶Âëä', {
                        confirmButtonText: 'Á°ÆÂÆö', cancelButtonText: 'ÂèñÊ∂à', type: 'warning'
                    });
                    const response = await fetch(`/api/images/${imageId}`, {method: 'DELETE'});
                    if (response.ok) {
                        ElMessage.success('ÂõæÁâáÂà†Èô§ÊàêÂäü');
                        loadAlbumImages(currentAlbum.value.id);
                        if (currentAlbum.value.cover_image_id === imageId) loadAlbums();
                    }
                } catch (error) {
                    if (error !== 'cancel') ElMessage.error('Âà†Èô§ÂõæÁâáÂ§±Ë¥•');
                }
            };

            const setAsCover = async (imageId) => {
                try {
                    const response = await fetch(`/api/albums/${currentAlbum.value.id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({cover_image_id: imageId})
                    });
                    if (response.ok) {
                        ElMessage.success('Â∞ÅÈù¢ËÆæÁΩÆÊàêÂäü');
                        currentAlbum.value.cover_image_id = imageId;
                        loadAlbums();
                    }
                } catch (error) {
                    ElMessage.error('ËÆæÁΩÆÂ∞ÅÈù¢Â§±Ë¥•');
                }
            };

            const downloadImage = async (imageId) => {
                try {
                    const response = await fetch(`/api/images/${imageId}/file?type=original`);
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = currentImage.value.original_filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } catch (error) {
                    ElMessage.error('‰∏ãËΩΩÂõæÁâáÂ§±Ë¥•');
                }
            };

            const formatDate = (dateString) => {
                if (!dateString) return '';
                return new Date(dateString).toLocaleDateString('zh-CN');
            };

            const formatFileSize = (bytes) => {
                if (!bytes) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            onMounted(() => {
                loadAlbums();
            });


            //rename start
            // Ê∑ªÂä†Áä∂ÊÄÅ
            const renamingFile = ref(false);
            const newFilename = ref('');


// ÂºÄÂßãÈáçÂëΩÂêç
            const startRename = () => {
                newFilename.value = currentImage.value.original_filename;
                renamingFile.value = true;

            }

// Á°ÆËÆ§ÈáçÂëΩÂêç
            const confirmRename = async () => {
                if (!newFilename.value.trim()) {
                    ElMessage.warning('Êñá‰ª∂Âêç‰∏çËÉΩ‰∏∫Á©∫');
                    return;
                }

                if (newFilename.value === currentImage.value.original_filename) {
                    renamingFile.value = false;
                    return;
                }

                try {
                    const response = await fetch(`/api/images/${currentImage.value.id}/rename`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            new_filename: newFilename.value
                        })
                    });

                    if (response.ok) {
                        ElMessage.success('ÈáçÂëΩÂêçÊàêÂäü');
                        currentImage.value.original_filename = newFilename.value;
                        renamingFile.value = false;
                    } else {
                        const data = await response.json();
                        ElMessage.error(data.error || 'ÈáçÂëΩÂêçÂ§±Ë¥•');
                    }
                } catch (error) {
                    ElMessage.error('ÈáçÂëΩÂêçÂ§±Ë¥•');
                }
            };

// ÂèñÊ∂àÈáçÂëΩÂêç
            const cancelRename = () => {
                renamingFile.value = false;
                newFilename.value = '';
            };

// rename end


            //favourtie start
// Ê∑ªÂä†Êî∂ËóèÁä∂ÊÄÅÁÆ°ÁêÜ
            const toggleFavorite = async (imageId) => {
                try {
                    const response = await fetch(`/api/images/${imageId}/favorite`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        // Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
                        const imageIndex = images.value.findIndex(img => img.id === imageId);
                        if (imageIndex !== -1) {
                            images.value[imageIndex].is_favorited = data.is_favorited;
                        }
                        // Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®Êü•ÁúãÁöÑÂõæÁâáË¢´Êî∂Ëóè/ÂèñÊ∂àÊî∂ËóèÔºå‰πüÊõ¥Êñ∞ÂΩìÂâçÂõæÁâáÁä∂ÊÄÅ
                        if (currentImage.value && currentImage.value.id === imageId) {
                            currentImage.value.is_favorited = data.is_favorited;
                        }

                        ElMessage.success(data.is_favorited ? 'Êî∂ËóèÊàêÂäü' : 'ÂèñÊ∂àÊî∂Ëóè');
                    }
                } catch (error) {
                    ElMessage.error('Êìç‰ΩúÂ§±Ë¥•');
                }
            };

// fav end


            //duoxuan start
// Ê∑ªÂä†Â§öÈÄâÁä∂ÊÄÅ
            const selectionMode = ref(false);
            const selectedImages = ref([]);


// ÂàáÊç¢ÈÄâÊã©Ê®°Âºè
            const toggleSelectionMode = () => {
                selectionMode.value = !selectionMode.value;
                if (!selectionMode.value) {
                    // ÈÄÄÂá∫ÈÄâÊã©Ê®°ÂºèÊó∂Ê∏ÖÁ©∫ÈÄâÊã©
                    selectedImages.value = [];
                }
            };

// Â§ÑÁêÜÂõæÁâáÁÇπÂáª
            const handleImageClick = (imageId) => {
                if (selectionMode.value) {
                    // ÈÄâÊã©Ê®°Âºè‰∏ãÂàáÊç¢ÈÄâÊã©Áä∂ÊÄÅ
                    const index = selectedImages.value.indexOf(imageId);
                    if (index > -1) {
                        selectedImages.value.splice(index, 1);
                    } else {
                        selectedImages.value.push(imageId);
                    }
                } else {
                    // Ê≠£Â∏∏Ê®°Âºè‰∏ãÊü•ÁúãÂõæÁâá
                    viewImage(imageId);
                }
            };

// ÊâπÈáèÂà†Èô§ÂõæÁâá
            const batchDeleteImages = async () => {
                if (selectedImages.value.length === 0) return;

                try {
                    await ElMessageBox.confirm(
                        `Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedImages.value.length} Âº†ÂõæÁâáÂêóÔºü`,
                        'Ë≠¶Âëä',
                        {
                            confirmButtonText: 'Á°ÆÂÆö',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning',
                        }
                    );

                    // ÈÄê‰∏™Âà†Èô§ÈÄâ‰∏≠ÁöÑÂõæÁâá
                    const deletePromises = selectedImages.value.map(imageId =>
                        fetch(`/api/images/${imageId}`, {method: 'DELETE'})
                    );

                    await Promise.all(deletePromises);

                    ElMessage.success(`ÊàêÂäüÂà†Èô§ ${selectedImages.value.length} Âº†ÂõæÁâá`);

                    // Ê∏ÖÈô§ÈÄâÊã©Áä∂ÊÄÅÂπ∂ÈáçÊñ∞Âä†ËΩΩÂõæÁâá
                    selectedImages.value = [];
                    selectionMode.value = false; // ÈÄÄÂá∫ÈÄâÊã©Ê®°Âºè
                    await loadAlbumImages(currentAlbum.value.id);

                    // Â¶ÇÊûúÂà†Èô§‰∫ÜÂ∞ÅÈù¢ÂõæÁâáÔºåÈáçÊñ∞Âä†ËΩΩÁõ∏ÂÜåÂàóË°®
                    if (selectedImages.value.includes(currentAlbum.value.cover_image_id)) {
                        loadAlbums();
                    }

                } catch (error) {
                    if (error !== 'cancel') {
                        ElMessage.error('ÊâπÈáèÂà†Èô§Â§±Ë¥•');
                    }
                }
            };


// ÂÖ®ÈÄâÂõæÁâá
//             const selectAllImages = () => {
//                 if (selectedImages.value.length === images.value.length) {
//                     // Â¶ÇÊûúÂ∑≤ÁªèÂÖ®ÈÄâÔºåÂàôÊ∏ÖÁ©∫ÈÄâÊã©
//                     selectedImages.value = [];
//                 } else {
//                     // Âê¶ÂàôÈÄâÊã©ÊâÄÊúâÂõæÁâá
//                     selectedImages.value = images.value.map(img => img.id);
//                 }
//             };

// Ê∑ªÂä†ËÆ°ÁÆóÂ±ûÊÄßÊòæÁ§∫ÂÖ®ÈÄâÁä∂ÊÄÅÔºàÂèØÈÄâÔºâ
//             const isAllSelected = computed(() => {
//                 return selectionMode.value &&
//                     images.value.length > 0 &&
//                     selectedImages.value.length === images.value.length;
//             });


            // ‰øÆÊîπÂÖ®ÈÄâËÆ°ÁÆóÂ±ûÊÄßÔºåÂü∫‰∫éÁ≠õÈÄâÂêéÁöÑÂõæÁâá
const isAllSelected = computed(() => {
    return selectionMode.value &&
           filteredImages.value.length > 0 &&
           selectedImages.value.length === filteredImages.value.length;
});

// ‰øÆÊîπÂÖ®ÈÄâÂáΩÊï∞ÔºåÂü∫‰∫éÁ≠õÈÄâÂêéÁöÑÂõæÁâá
const selectAllImages = () => {
    if (selectedImages.value.length === filteredImages.value.length) {
        // Â¶ÇÊûúÂ∑≤ÁªèÂÖ®ÈÄâÔºåÂàôÊ∏ÖÁ©∫ÈÄâÊã©
        selectedImages.value = [];
    } else {
        // Âê¶ÂàôÈÄâÊã©ÊâÄÊúâÁ≠õÈÄâÂêéÁöÑÂõæÁâá
        selectedImages.value = filteredImages.value.map(img => img.id);
    }
};
            //duoxuan end



            // Âè™ÁúãÊî∂Ëóèstart
// Ê∑ªÂä†Êî∂ËóèÁ≠õÈÄâÁä∂ÊÄÅ
const showFavoritesOnly = ref(false);

// ËÆ°ÁÆóÁ≠õÈÄâÂêéÁöÑÂõæÁâáÂàóË°®
const filteredImages = computed(() => {
    if (showFavoritesOnly.value) {
        return images.value.filter(img => img.is_favorited);
    }
    return images.value;
});

// ÂàáÊç¢Êî∂ËóèÁ≠õÈÄâ
const toggleFavoriteFilter = () => {
    showFavoritesOnly.value = !showFavoritesOnly.value;
    // ÂàáÊç¢Á≠õÈÄâÊó∂Ê∏ÖÁ©∫ÈÄâÊã©Áä∂ÊÄÅ
    selectedImages.value = [];
};

            // Âè™ÁúãÊî∂Ëóèend

            return {
                currentView, albums, images, currentAlbum, currentImage,
                showCreateAlbumDialog, showEditAlbumDialog, showUploadDialog,
                newAlbum, currentImageIndex, hasPrev, hasNext,
                getAlbumImageCount, loadAlbums, loadAlbumImages, createAlbum, updateAlbum,
                deleteAlbum, openAlbum, backToAlbums, backToAlbum, viewImage,
                prevImage, nextImage, handleUploadSuccess, handleUploadError,
                beforeUpload, deleteImage, setAsCover, downloadImage,
                formatDate, formatFileSize, renamingFile,
                newFilename,
                startRename,
                confirmRename,
                cancelRename, toggleFavorite,
                selectionMode,
                selectedImages,
                toggleSelectionMode,
                handleImageClick,
                batchDeleteImages,
                selectAllImages,
                isAllSelected,
                  showFavoritesOnly,
    filteredImages,
    toggleFavoriteFilter,
            };
        }
    }).use(ElementPlus).mount('#app');
</script>
</body>
</html>